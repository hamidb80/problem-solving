# Advent of Code 2023 day 3 in BQN
# ideas from https://www.youtube.com/watch?v=77uUu4vcZ-8
# XXX works on the test input but not actual input :(

inp â† "467..114..
...*......
..35..633.
......#...
617*......
.....+.58.
..592.....
......755.
...$.*....
.664.598.."


nl â† @+10
Stencil3  â† {
  map  â† ğ•©
  râ€¿c â† â‰¢ map
  Fn â† {
    a â† 0 âŒˆ (r-1) âŒŠ (ğ•¨-1)
    b â† 3 - (ğ•¨=0) âˆ¨ (ğ•¨=r-1)
    
    c â† 0 âŒˆ (c-1) âŒŠ (ğ•©-1)
    d â† 3 - (ğ•©=0) âˆ¨ (ğ•©=c-1)
    
    indexes â† Â¯1âŠ¸â‰  âŠ¸/ â· â¥Š {dâ†‘ câ†“ ğ•©} Ë˜ bâ†‘ aâ†“ map
  }
  (â†•r) FnâŒœ â†•c
}
SplitGrid â† ((Â¯1+ (1+`âŠ¢) âˆ§ Â¬) nlâŠ¸=) âŠ” âŠ¢
Solve â† {
  grid      â† > SplitGrid ğ•©
  relaxed   â† â¥Š grid
  digitsi   â† âˆŠâŸœ"0123456789" Ë˜ relaxed
  first     â† <Â´Ë˜ 2â†• 0 âˆ¾ digitsi
  uniq      â† Â¯1 + (+` first) âˆ§ digitsi
  numbers   â† â€¢ParseFloat Â¨ uniq âŠ” relaxed
  map       â† uniq â¥ŠËœ â‰¢grid
  adjacencyMapR â† â¥Š Stencil3 map
  part1  â† +Â´       numbers âŠËœ âˆ¾            (Â¬ relaxed âˆŠ ".0123456789") / adjacencyMapR  
  part2  â† +Â´ Ã—Â´ Ë˜ (numbers âŠËœ > {2=â‰ âˆ˜>Ë˜ğ•©} âŠ¸/ (relaxed âˆŠ "*")           / adjacencyMapR)
  part1 â‹ˆ part2
}

Solve inp

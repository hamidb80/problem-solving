# Advent of Code 2023 day 3 in BQN
# ideas from https://www.youtube.com/watch?v=77uUu4vcZ-8
# XXX works on the test input but not actual input :(

inp â† "467..114..
...*......
..35..633.
......#...
617*......
.....+.58.
..592.....
......755.
...$.*....
.664.598.."

nl â† @+10
SplitGrid â† ((Â¯1+ (1+`âŠ¢) âˆ§ Â¬) nlâŠ¸=) âŠ” âŠ¢
Solve â† {
  grid      â† > SplitGrid ğ•©
  relaxed   â† â¥Š grid
  digitsi   â† âˆŠâŸœ"0123456789" Ë˜ relaxed
  first     â† <Â´Ë˜ 2â†• 0 âˆ¾ digitsi
  uniq      â† Â¯1 + (+` first) âˆ§ digitsi
  numbers   â† â€¢ParseFloat Â¨ uniq âŠ” relaxed
  map       â† uniq â¥ŠËœ â‰¢grid
  râ€¿c      â† â‰¢ grid # rowsâ€¿cols

  Stencil  â† {
    nr â† 0 âŒˆ (r-1) âŒŠ (ğ•¨-1)
    xr â† 3 - (ğ•¨=0) âˆ¨ (ğ•¨=r-1)
    
    nc â† 0 âŒˆ (c-1) âŒŠ (ğ•©-1)
    xc â† 3 - (ğ•©=0) âˆ¨ (ğ•©=c-1)
    
    indexes â† {ğ•©â‰ Â¯1}âŠ¸/ â· â¥Š (xcâŠ¸â†‘ ncâŠ¸â†“) Ë˜ xr â†‘ nr â†“ map
  }
  adjacencyMap â† (â†•r) StencilâŒœ â†•c
  adjacencyMapRelaxed â† â¥ŠadjacencyMap
  filterP1  â† Â¬ relaxed âˆŠ ".0123456789"
  filterP2  â†   relaxed âˆŠ "*"          
  temp1  â† filterP1 / adjacencyMapRelaxed
  temp2  â† filterP2 / adjacencyMapRelaxed 
  ii2    â† {2=â‰ >ğ•©} Ë˜ temp2
  sel1   â† (âŠâŸœnumbers) Ë˜ âˆ¾      temp1
  sel2   â† (âŠâŸœnumbers) Ë˜ > ii2 / temp2
  part1  â† +Â´      sel1
  part2  â† +Â´ Ã—Â´ Ë˜ sel2
  part1 â‹ˆ part2
}

Solve inp
